<div class="container">
  <%= render  "/layouts/menu" %>
  <div class="content">
    <div class="form-edit">
      <h2>Edit <%= resource_name.to_s.humanize %></h2>

      <%= form_for(resource, as: resource_name, url: user_registration_path, html: { method: :put, multipart: true }) do |f| %>
        <%= render "users/shared/error_messages", resource: resource %>
        <div class="msg-errors">
          <p class="notice"><%= notice %></p>
          <p class="alert"><%= alert %></p>
        </div>
        <div class="form-group">
          <%= f.label :name %><br />
          <%= f.text_field :name, autofocus: true, autocomplete: "name", class: "form-control", placeholder: "Enter your fullname" %>
        </div>
        <div class="form-group">
          <%= f.label :phone %><br />
          <%= f.text_field :phone, autocomplete: "phone", class: "form-control", placeholder: "Enter your phone number" %>
        </div>
        <div class="form-group">
          <%= f.label :email %><br />
          <%= f.email_field :email, autofocus: true, autocomplete: "email", placeholder: "Enter your email...", class: "form-control" %>
        </div>
        <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
          <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
        <% end %>

        <div class="form-group">
          <%= f.label :password %><br> <i>(leave blank if you don't want to change it)</i><br />
          <%= f.password_field :password, autocomplete: "new-password", placeholder: "Enter your new password...", class: "form-control" %>
          <% if @minimum_password_length %>
            <em><%= @minimum_password_length %> characters minimum</em>
          <% end %>
        </div>

        <div class="form-group">
          <%= f.label :password_confirmation %><br />
          <%= f.password_field :password_confirmation, autocomplete: "new-password", placeholder: "Enter your new password again...", class: "form-control" %>
        </div>

        <div class="form-group">
          <%= f.label :current_password %> <br> <i>(we need your current password to confirm your changes)</i><br />
          <%= f.password_field :current_password, autocomplete: "current-password", placeholder: "Enter your current password...", class: "form-control" %>
        </div>

        <div class="form-group">
          <%= f.label :change_avatar %>
          <div class="file-upload">
            <button class="file-upload-btn" type="button" onclick="$('.file-upload-input').trigger( 'click' )">Add Image</button>

            <div class="image-upload-wrap">
              <%= f.file_field :image, class: "file-upload-input", onchange: "readURL(this);", accept: "image/*" %>
              <div class="drag-text">
                <h3>Drag and drop a file or select add Image</h3>
              </div>
            </div>
            <div class="file-upload-content">
              <%= if current_user.image? 
              
                  image_tag( current_user.image.url(:thumb), class: "file-upload-image", alt: "your image") 
                else 
                  image_tag( "", class: "file-upload-image", alt: "your image")
                end
              %>
              <div class="image-title-wrap">
                <button type="button" onclick="removeUpload()" class="remove-image">Remove <span class="image-title">Uploaded Image</span></button>
              </div>
            </div>
          </div>
        </div>

        <div class="actions">
          <%= link_to "Back", :back, class: "btn btn-dark" %>
          
          <%= f.submit "Update", class: "btn btn-primary" %>
        </div>
        
      <% end %>
      <div class="row-btn-delete">
          <span>Unhappy?</span><%= button_to "Cancel my account", registration_path(resource_name), data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-link" %>
      </div>
    </div>
  </div>
</div>
<%= render  "/layouts/footer" %>
<script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> 
<script>
  function readURL(input) {
    if (input.files && input.files[0]) {

      var reader = new FileReader();

      reader.onload = function(e) {
        $('.image-upload-wrap').hide();

        $('.file-upload-image').attr('src', e.target.result);
        $('.file-upload-content').show();

        $('.image-title').html(input.files[0].name);
      };

      reader.readAsDataURL(input.files[0]);

    } else {
      removeUpload();
    }
  }

  function removeUpload() {
    $('.file-upload-input').replaceWith($('.file-upload-input').clone());
    $('.file-upload-content').hide();
    $('.image-upload-wrap').show();
  }
  $('.image-upload-wrap').bind('dragover', function () {
          $('.image-upload-wrap').addClass('image-dropping');
      });
      $('.image-upload-wrap').bind('dragleave', function () {
          $('.image-upload-wrap').removeClass('image-dropping');
  });
</script>